# 패키지

패키지는 Go 언어제서 코드를 묶는 가장 큰 단위입니다.



## 패키지

### main 패키지

main 패키지는 특별한 패키지로 프로그램 시작점을 포함한 패키지입니다. 프로그램 시작점이란 mian( ) 함수를 의미합니다.'

프로그램이 실행되면 (대부분) 운영체제는 프로그램을 메모리로 올립니다.

이것을 로드(Load) 라고합니다.

그런다음 프로그램 시작점부터 한 줄씩 코드를 실행합니다.

바로 이 프로그램 시작점이 main( ) 함수이고 main( ) 함수를 포함한 패키지가 main 패키지입니다.



### 그외 패키지

한 프로그램은 main 패키지 외에 다수의 다른 패키지를 포함할 수 있습니다.

예를 들어 게임에 그래픽, 사운드, 네트워크, AI 기능들을 제공한다고 해봅시다.

이런 기능을 처음부터 끝까지 모두 만들어야한다 시간과 비용이 엄청나게 들어갑니다.

그런데 각 기능을 제공하는 패키지가 있다면 그저 가져다 쓰기만 하면 됩니다.

표준 입출력은 fmt 패키지를, 암호화는 crypto 패키지를, 네트워크 기능은 net 패키지를 임포트(import) 하여 사용하면됩니다.

이미 세상에는 수 많은 패키지가 제공되므로 프로그램을 만들 때는 원하는 기능을 제공하는 패키지를 먼저 찾아보는 습관을 들이는 것이 좋습니다.



### 유용한 패키지 찾기

우리가 생각하는 대부분의 기능들은 이미 패키지로 배포하고있습니다. 시간이 곧 돈이고 기회입니다.

원하는 패키지를 빠르게 찾아내고 조합하여 구현하는것이 최고입니다.

[Go 표준 패키지](https://golang.org/pkg/)

[Go 외부 패키지](https://github.com/avelino/awesome-go)





## 패키지 사용하기

패키지를 사용하려면 import 예약어로 임포트를 하고 원하는 패키지 경로를 따옴표로 묶어서 사용합니다.

**외부 노출 여부는 변수명, 함수명, 구조체명의 첫 글자가 대문자인지 소문자인지로 구분합니다.**

대문자로 시작하면 외부 노출이 되고, 소문자로 시작하면 노출되지 않습니다.



### 임포트하기

import 뒤에 패키지명을 큰 따옴표로 묶어서 적습니다.

```go
import "fmt"
```



소괄호로 묶어서 여러 패키지를 임포트 할수 있습니다.

```go
import (
	"fmt"
  "os"
)
```



### 패키지 멤버에 접근하기

패키지를 가져오면 해당 패키지명을 쓰고 점(`.`) 연산자를 사용해 패키지에서 제공하는 함수, 구조체 등에 접근할수 있습니다.

```go
fmt.Println("HI")
```



### 경로가 있는 패키지 사용하기

경로가 있는 패키지를 사용하는 방법이 있습니다.

```go
package main

import (
	"fmt"
  "math/rand" // 패키지명은 rand 입니다.
)

func main() {
  fmt.Println(rand.Int()) // 랜덤 숫자 출력
}
```

경로가 있는 패키지에 접근 할때는 마지막 폴더명인 rand 만 사용합니다.



### 중복된 패키지 명 별칭으로 해결하기

만약 패키지 명이 중복된다면 별칭(alias) 를 사용할 수 있습니다.

```go
import (
	"text/template"
  htemplate "html/template"
)
```

위처럼 임포트 되는 문장의 앞에 별칭을 지정해주면 `htemplate` 라는 변수명으로 호출이 가능합니다.



### 사용하지 않는 패키지 포함하기

패키지를 가져오면 반드시 사용해야 합니다.

패키지를  import 하고 나서 사용하지 않으면 에러가 발생합니다.

패키지를 직접 사용하지 않지만 부가효과를 얻고자 임임포트하는 경우는 `_`을 앞에 붙여줍니다.

```go
import (
	"database/sql"
  _ "github.com/mattn/go-sqlite3"
)
```



### 패키지 설치하기

import로 패키지를 포함시키면 `go build` 를 통해서 빌드할 때 해당하는 패키지를 찾아서 포함한 다음 실행 파일을 생성하게됩니다.

그럼 Go는 import된 패키지를 어떻게 찾을까요? 다음 3가지 방법으로 찾습니다.

- **Go언어에서 기본 제공하는 패키지는 Go 설치 경로에서 찾습니다. **

  Go를 설치할 때 Go언어에서 제공하는 기본 패키지들까지 같이 설치됩니다.

  그래서 기본 패키지들은 Go 설치 경로에 포함되어있습니다.

- **깃허브와 같은 외부 저장소에 저장된 패키지의 경우 외부 저장소에서 다운받아서** `GOPATH/pkg` **폴더에 설치합니다.**

  이때 Go 모듈에 정의된 패키지 버전에 맞게 다운로드 하게됩니다.

- **현재 모듈 아래 위치한 패키지인지 검사합니다.**

  현재 모듈 아래 위치한 패키지는 현재 폴더 아래 있는 패키지를 찾습니다. (내가 작성한 코드입니다.)





## Go 모듈

Go 모듈은 Go 패키지들을 모아놓은 Go 프로젝트 단위입니다.

`Go 1.16` 버전부터 Go모듈 사용이 기본이 되었습니다.

이전까지 Go모듈을 만들지 않은 Go코드는 모두 `GOPATH/src` 폴더아래 있어야 했지만 

**Go모듈이 기본이 되면서 모든 Go코드는 Go모듈 아래 있어야합니다.**

**go build를 하려면 반드시 Go모듈 루트 폴더에 go.mod 파일이 있어야합니다.**

> go.mod 파일
>
>이 파일은 Go 버전, 필요한 외부 패키지등이 명시되어있습니다.
>
>Go 언어에서는 go build를 통해 실행파일(exe)을 만들때 go.mod 와 
>
>외부 저장소 패키지 버전 정보를 담고있는 go.sum파일을 통해 외부 패키지와 모듈 내 패키지를 합쳐서 실행 파일을 만듭니다.

Go 모듈은 go mod init 명령을 통해 만들 수 있습니다.

```bash
$ go mod init [pkg 이름]
```



### Go 모듈을 만들고 외부 패키지 활용하기

```go
package main

import (
	"fmt"
	"main/testpkg"

	"github.com/guptarohit/asciigraph"
)

func main() {
	fmt.Println("HI")
	testpkg.PrintTest()

	data := []float64{3, 4, 5, 6, 6, 7, 8, 9}
	graph := asciigraph.Plot(data)
	fmt.Println(graph)
}
```

다음과 같이 코드를 짜게 되면 `github` 에서 가져온 패키지를 다운로드 받지 않아 오류가 발생하게 됩니다.

이때는 `go mod tidy` 를 사용하면되는데요.

이 명령은 Go 모듈에 필요한 패키지를 찾아서 다운로드 해주고 필요한 패키지 정보를 go.mod 파일과 go.sum 파일에 적어주게 됩니다.

![image-20220713093921929](14.패키지.assets/image-20220713093921929.png) 

확인을 해보면 `go.mod` 파일은 변경이 되었고 `go.sum` 파일이 생성된것을 볼 수 있습니다.

`go.mod` 파일을 보면 require와 함께 외부 패키지가 명시되어 있는데요.

주의 할 점은 모듈의 이름과 외부 패키지의 이름이 겹치지 않도록 주의해야합니다.

또한 모듈의 마지막이름은 되도록 폴더의 이름과 같게 만드는 것이 좋습니다.





## 패키지명과 패키지 외부 공개

Go 언어에서 패키지명은 쉽고 간단하게 이름지을 것을 권장합니다.

그리고 모든 문자를 소문자로 할 것을 권장하고 있습니다.

패키지 전역으로 선언된 첫 글자가 대문자로 시작되는 모든 변수, 상수, 타입, 함수, 메서드는 패키지 외부로 공개됩니다.

**구조체 이름의 첫 글자가 대문자이고 필드명 역시 첫 글자가 대문자**인 구조체의 필드 역시 패키지 외부로 공개됩니다.





## 패키지 초기화 하기

패키지를 임포트 하면 어떤 일이 벌어지는지 확인해보겠습니다.

패키지를 임포트 하면 컴파일러는 패키지 내 **전역 변수**를 초기화합니다.

그럼 다음 패키지에 `init( )` 함수가 있다면 호출해 패키지를 포기화 합니다.

`init( )` 함수는 반드시 입력 매개변수가 없고 반환값도 없는 함수여야합니다.

만약 어떤 패키지의 초기화 함수인 `init( )` 함수 기능만 사용하길 원한다면 밑줄 `(_)` 을 이용해서 임포트 합니다.

```go
import (
  "database/sql"
  _ "github.com/test/test"
)
```

