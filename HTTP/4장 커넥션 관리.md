## 커넥션 관리

HTTP 커넥션 관리는 시행착오를 통해서라도 많은 것을 배울 수 있는 어떨게 보면 마술 같은 기술이다.

---



## TCP 커넥션

전 세계 모든 HTTP 통신은, 지구상의 컴퓨터와 네트워크 장비에서 널리 쓰이고 있는 패킷 교환 네크워크 프로토콜들의 **계층화된** 집합인 **TCP/IP** 를 통해 이루어진다.

세계 어디서든 클라이언트 애플리케이션은 서버 애플리케이션으로 TCP/IP 커넥션을 맺을 수 있다.

일단 커넥션이 맺어지면 클라이언트와 서버 컴퓨터 간에 주고받는 메시지들은 손실 혹은 손상되거나 순서가 바뀌지 않고 안전하게 전달된다.

>어떤 주소에 요청을 한다고 가정할때 일어나는 과정을 보도록하자.
>
>`http://www.dan.com:80/test.html` 로 요청을 보낸다.
>
>- 브라우저가 `www.dan.com` 이라는 호스트명을 추출한다.
>- 브라우저가 이 호스트 명에 대한 public IP 주소를 찾는다. `ex) 202.44.52.3`
>- 브라우저가 포트 번호 80을 얻는다.
>- 브라우저가 `202.44.52.3`의 `80` 포트로 TCP 커넥션을 생성한다.
>- 브라우저가 서버로 HTTP GET 요청 메시지를 보낸다.
>- 브라우저가 서버에서 온 HTTP 응답 메시지를 읽는다.
>- 브라우저가 커넥션을 끊는다.



### 신뢰할 수 있는 데이터 전송 TCP

HTTP 커넥션은 몇몇 사용 규칙을 제외하고는 TCP 커넥션에 불과하다.

TCP 커넥션은 인터넷을 안정적으로 연결해준다.

신속 정확하게 데이터를 보내고자 한다면 TCP의 기초적인 내용을 알아야한다.

TCP 커넥션은 클라이언트에 있는 바이트들을 반대쪽으로 순서에 맞게 정확히 전달한다.



### TCP 스트림은 세그먼트로 나뉘어 IP 패킷을 통해 전송된다.

TCP는 IP 패킷이라고 불리는 작은 조각을 통해 데이터를 전송한다.

HTTP는 IP, TCP, HTTP로 구성된 `프로토콜 스택` 에서 최상위 계층이다.

HTTP에 보안 기능을 더한 HTTPS 는 TLS 혹은 SSL이라 불리기도 하며 HTTP와 TCP사이에 있는 암호와 계층이다.

![image-20220710181750262](4장 커넥션 관리.assets/image-20220710181750262.png) 

HTTP가 메시지를 전송하고자 할때, 현재 연결되어있는 TCP 커넥션을 통해 메시지 데이터의 내용을 순서대로 보낸다.

TCP는 **세그먼트**라는 단위로 데이터 스트림을 잘게 나누고, 세그먼트를 **IP 패킷** 이라고 불리는 봉투에 담아서 인터넷을 통해 데이터를 전달한다.

이 모든 것은 TCP/IP 소프트웨어에 의해 처리되며, 그 과정은 프로그래머에게 보이지 않는다.



### TCP 커넥션 유지하기

컴퓨터는 항상 TCP 커넥션을 여러개 가지고 있다.

TCP는 포트 번호를 통해서 이런 여러개의 커넥션을 유지한다.

포트 번호는 회사 직원의 내선전화와 같다.

IP번호는 해당 컴퓨터에 연결되고, 포트 번호는 해당 애플리케이션으로 연결된다.

TCP 커넥션은 네가지 값으로 식별한다.

```http
<발신지 IP주소, 발신지 포트, 수신지 IP주소, 수신지 포트>
```

이 네 가지 값으로 유일한 커넥션을 생성한다.

서로 다른 두개의 TCP 커넥션은 네가지 주소 수성요소의 값이 모두 같을수 없다.

다음과같이 말이다.

![image-20220710182505977](4장 커넥션 관리.assets/image-20220710182505977.png) 



### TCP 소켓 프로그래밍

운영체제는 TCP 커넥션의 생성과 관련된 여러 기능을 제공한다.

여러가지 TCP API와 프로그래밍 인터페이스들이 있다.

소켓에 대한  API를 사용하면, TCP 종단 데이터 구조를 생성하고, 원격 서버의 TCP 종단에 그 종단 데이터 구조를 연결하여 데이터 스트림을 읽고 쓸 수 있다.