# 3장

---

냄새 나면 당장 갈아라



## 기이한 이름

코드를 명료하게 표현하는것은 바로 `이름` 이다.

하지만 컴퓨터 공학에서 가장 어려운 작업중에 하나이기도 하다 (나머지 하나는 캐시 무효화)

혼란스러운 이름을 잘 정리하다 보면 코드가 훨씬 간결해질 때가 많다.



## 중복 코드

똑같은 코드 구조가 반복된가면 하나로 통합하여 더 나은 프로그램을 만들 수 있다.

한 클래스에 딸린 두 메서드가 똑같은 표현식을 사용하는 경우 **함수 추출하기**를 사용하여 양쪽 모두 추출된 메서드를 호출하게 하자.

코드가 비슷한데 완전히 똑같지 않다면 **문장 슬라이드하기** 를 사용하여 비슷한 부분을 한대 모아 함수 추출하기를 적용한다.

같은 부모로부터 파생된 서브 클래스들에 중복 코드가 발생한다면, 각자 따로 호출되지 않도록 **메서드 올리기**를 적용한다.



## 긴 함수

짧은 함수로 구성된 코드를 이해하기 쉽게 만드는 가장 확실한 방법은 좋은 이름이다.

이름을 잘 지어두면 본문 코드를 볼 이유가 사라진다.

함수를 짧게 만드는 작업의 99%는 함수 추출하기가 차지한다.

주석은 코드만으로 목적을 이해하기 힘든경우 달때가 많다. 그렇기 때문에 주석이 달리는 부분에 설명과 함께 따로 함수로 만드는것이좋다.

조건문은 **조건문 분해하기**로 대응한다.

거대한 switch문은 case마다 **함수 추출하기**를 적용하여 case본문을 함수 호출문으로 바꾼다.

switch 문이 여러개라면 **조건문을 다형성**으로 바꾸기를 적용한다.



## 긴 매개변수 목록

다른 매개변수에서 값을 얻어올 수 있다면 **매개변수 질의 함수로 바꾸기** 를 사용하여 매개변수를 제거하자.

사용중인 데이터 구조에서 값들을 뽑아 각각을 별개의 매개변수로 전달 하는 코드면 **객체 통째로 넘기기** 를 적용한다.

항상 함께 전달되는 매개변수들은 **매개변수 객체 만들기** 를 적용한다.

함수의 동작 방식을 정하는 플래그 역할싀 매개변수는 **플래그 인수 제거하기** 로 없애준다.



## 전역 데이터

전역으로 사용되는 데이터는 **싱글톤 페턴** 또는 화자가 말하는 방향으로 바꿀수있다.

또는 변수 `캡슐화 하기` 등을 사용하여 리팩터링 할 수있다.



## 가변 데이터

데이터를 변경했더니 예상치 못한 결과나 버그로 이어질 경우 원본데이터는 그대로 보존하고 복사본을 만들어 작업을 할 수있다.

또는 `변수 캡슐화하기` 를 사용한다던지 `변수 쪼개기` 를 이용하여 용도별로 독립 변수에 저장하는 방법이 있다.

API를 만들때는 `질의 함수와 변경 함수 분리하기` 를 사용하여 꼭 필요한 경우가 아니라면 부작용이 있는 코드를 호출 할 수 없도록 한다.

우리는 가능한한 세터 제거하기등도 적용을 한다.

변수의 유효기간이 몇 줄이라면 가변 데이터라고 하여도 문제는 없다. 하지만 유효범위가 넓어지게 된다면 `여러함수 클래스로 묶기` ,`여러 함수를 변환 함수로 묶기` 를 활용하여 코드의 유효범위를 제한하도록 하자.



## 뒤엉킨 변경

뒤엉킨 변경은 단일 책임 원칙 (SRP) 이 제대로 지켜지지 않을 때 나타난다.

이러한 경우 `단계쪼개기` 나 `함수추출하기` 등을 사용하여 분할 시키도록하자.



## 산탄총 추출

산탄총 추출은 뒤엉킨 변경과 비슷하면서도 정 반대이다.

이 경우는 코드를 변경할 때마다 자잘하게 수정해야 하는 클래스가 많을 때 적용한다.

이럴때는 변경되는 대상들을 `함수 옮기기` 와 `필드 옮기기` 로 모두 한 모듈에 묶어두면 좋다.

비슷한 데이터를 다루는 함수가 많다면 `여러함수를 클래스로 묶기` 를 적용한다.

데이터 구조를 변환하거나 보강하는 함수들에는 `여러 함수를 변환 함수로 묶기` 를 적용한다.

이렇게 묶은 함수들의 출력 결과를 묶에서 다음 단계의 로직으로 전달 할 수 있다면 `단계 쪼개기` 를 적용한다.



## 기능 편애

기능 편애는 원래 나의 함수에서의 역할 보다 다른 함수를 탐조하고 사용되는데 많은 역할을 할때를 말한다.

함수의 일부만 기능을 편애 할 수 있다. 

이럴때는 그 부분만 독립 함수로 빼낸다음 함수 추출하기로 원라는 모듈로 보내준다.

**만약 어디로 옮길지 고민이 된다면 가장 많이 호출**이 되고 있는곳에서 사용하는것이 좋다.



## 데이터 뭉치

데이터 들은 흔히 뭉쳐다니는걸 좋아하기 때문에 보금자리를 따로 마련해주는것이 좋다.

가장 먼저 필드 형태의 데이터 뭉치를 찾아서 클래스 추출하기로 하나의 객체로 묶어준다.

매개변수 객체 만들기나 객체를 통째로 넘기기를 적용해서 매개변수 수를 줄여본다.



## 기본형 집착



## 반복되는 switch문



## 반복문





