## 이벤트 소싱 패턴

데이터의 현재 상태만 도메인에 저장하는 대신 추가 전용 저장소를 사용하여 해당 데이터에 수행된 전체 작업을 기록합니다.

저장소는 레코드 시스템 역할을 하며, 도메인 개체를 구체화하는 데 사용될 수 있습니다.

이렇게 하면 데이터 모델과 비즈니스 도메인을 동기화할 필요가 없고 성능, 확장성 및 응답성이 향상되므로 복잡한 도메인의 태스크를 간소화할 수 있습니다. 

또한 트랜잭션 데이터에 일관성을 제공하고 보정 작업에 사용할 수 있는 전체 감사 추적 및 기록을 유지할 수 있습니다.

## 

### 배경

대부분의 어플리케이션은 데이터를 사용하여, 일반적인 접근 방법은 사용자가 데이터로 작업할 때 애플리케이션이 데이터의 현재 상태를 업데이트하여 유지 관리하는것 입니다.

일반적으로 이를 CRUD작업을 하여 관리한다고 말할수 있습니다.

CRUD의 제한사항은 다음과 같은 몇가지가 있습니다.

- 데이터 저장소에서 직접 업데이트 작업을 수행하므로 성능 및 응답 속도가 저하되고 필요한 오버헤드로 인해 확장성이 제한될수 있습니다.
- 많은 동시 사용자가 있는 공동 작업 도메인에서 데이터 업데이트 충돌은 대체로 업데이트 작업이 단일 데이터 항목을 수정할때 발생합니다.
- 세부 정보를 개별 로그에 기록하는 추가 감사 메커니즘이 없으면 기록이 유실됩니다.

위와같은 문제를 해결하고자 이런 패턴이 생성되었다.



### 적합성

필요 도메인에 각각 추가 전용 저장소를 할당하여 일련의 이벤트에 의해 구동되는 데이터 작업 처리 방법을 정의합니다.

이벤트의 시간의 순서에 의해 저장이되며 이벤트는 데이터의 현재 상태에 대한 레코드 시스템 역할을 하는 이벤트 저장소에 저장됩니다.

이벤트 소상은 다음과 같은 장점이 있습니다.

- 트랜젝션 처리중 경합이 없다는 사실과 더불어 이점으로 인해 특히 프레젠테이션 수준 또는 사용자 인터페이스에서 애플리케이션의 성능과 확장성이 훨씬 향상됩니다.
- 데이터 저장소의 개체를 직접 업데이트하지 않아도 되기 때문에 동시 업데이트로 인한 충돌을 방지할 수 있습니다. 그러나 도메인 모델이 상태 불일치를 초래할 수 있는 요청으로부터 보호되도록 디자인해야 합니다.
- 추가 전용 이벤트 스토리지에서 제공하는 감사 추적을 사용하면 데이터 스토리지에 대해 수행된 작업을 모니터하고, 언제든지 이벤트를 재생하여 현재 상태를 구체화된 뷰 또는 프로젝션으로 재생성하고, 시스템 테스트 및 디버그를 지원할 수 있습니다.
- 변경 내용을 취소하기 위해 보정 이벤트를 사용해야 하므로 모델이 현재 상태만 저장하는 경우와 달리 취소된 변경 기록이 제공됩니다. 이벤트 목록을 사용하여 애플리케이션 성능을 분석하고 사용자 행동 경향을 검색하거나 기타 유용한 비즈니스 정보를 얻을 수도 있습니다.



>  보통 이벤트 소싱은 일반적으로 이벤트에 대한 응답으로 데이터관리 태스크를 수행하고 저장된 이벤트에서 뷰를 구체화하여 CQRS 패턴과 많이 결합합니다.



### 이벤트 소싱이 사용되야 하는 상황

- 데이터에 의도, 목적 이유를 캡처하려는 경우
- 데이터 업데이트 충돌 발생을 최소화 하거나 완전히 방지하는 것이 중요한 경우
- 발생하는 이벤트를 기록하고 재생하여 시스템 상태를 복원하거나, 변경 내용을 롤백하거나, 기록 및 감사 로그를 유지하려는 경우
- 이벤트 사용이 애플리케이션 작업의 자연 기능이고 추가 개발 또는 구현 노력이 거의 필요하지 않은 경우
- 요구사항이 변경되거나 CQRS와 함께 사용되는 경우



### 이벤트 소싱이 사용되면 좋지 않은 상황

- 작거나 단순한 도메인, 비즈니스 논리가 거의 없거나 전혀 없는 시스템 또는 기존의 CRUD 데이터 관리 메커니즘에서 기본적으로 잘 작동하는 비도메인 시스템
- 데이터 뷰에 대한 일관성 및 실시간 업데이트가 필요한 시스템
- 감사 추적, 기록, 작업 롤백 및 재생 기능이 필요하지 않은 시스템
- 기본 데이터에 대한 업데이트 충돌 발생이 매우 적은 시스템. 예를 들어 데이터를 업데이트하지 않고 주로 추가하는 시스템입니다